version: "3.7"

services:
  frontend:
    image: kevinedwards/formsite-web:0.0.2
    container_name: frontend
    ports:
      - "80:80"
    environment:
      NODE_ENV: production
    networks:
      - prod

  backend:
    image: kevinedwards/formsite-api:0.0.1
    container_name: backend
    ports:
      - "3003:3003"
    envronment:
      NODE_ENV: production
      PORT: 3003
      REGISTRATION_ENABLED: 0
      LOGIN_ENABLED: 1
      #DB_URI: mongodb+srv://dynalifeAdmin:dynalifeAdmin123@cluster0.ohgz3.mongodb.net/dynalife?retryWrites=true&w=majority
      DB_URI: mongodb://dynalifeAdmin:dynalifeAdmin123@mongodb:27017/dynalife?authSource=dynalife
      JWT_SECRET: lshfosnfoshdfohvpng;w4vj0wu0ajc0iayvashvacaf
    networks:
      - prod

networks:
  prod:
    external: true
# docker run -itd \
#   -p 8000:8000 \
#   -p 9000:9000 \
#   --name=portainer \
#   --network prod \
#   --restart=always \
#   -v /var/run/docker.sock:/var/run/docker.sock \
#   -v $(pwd)/portainer/data:/data \
#   portainer/portainer-ce

# docker run -itd \
#   -p 8081:8081 \
#   --name=mongoex \
#   --network prod \
#   --restart=always \
#   -e ME_CONFIG_OPTIONS_EDITORTHEME=ambiance \
#   -e ME_CONFIG_MONGODB_SERVER=mongodb \
#   -e ME_CONFIG_MONGODB_ADMINUSERNAME=mongoadmin \
#   -e ME_CONFIG_MONGODB_ADMINPASSWORD=secret \
#   mongo-express

# docker run -itd \
#   -e MONGO_INITDB_ROOT_USERNAME=mongoadmin \
#   -e MONGO_INITDB_ROOT_PASSWORD=secret \
#   -v $(pwd)/mongodb/datadir:/data/db \
#   --network prod \
#   --name mongodb \
#   mongo

# docker run -it \
#   --network prod \
#   -v $(pwd):/mongostuff \
#   --rm mongo \
#   mongoimport --host mongodb \
#   -u mongoadmin \
#   -p secret \
#   -d dynalife \
#   -c forms \
#   --file /mongostuff/forms.json \
#   --jsonArray \
#   --authenticationDatabase admin

# docker run -itd \
#   --network prod \
#   --name backend \
#   -p 3003:3003 \
#   -e NODE_ENV=production \
#   -e PORT=3003 \
#   -e REGISTRATION_ENABLED=0 \
#   -e LOGIN_ENABLED=1 \
#   -e DB_URI='mongodb://mongoadmin:secret@mongodb:27017/dynalife?authSource=admin' \
#   -e JWT_SECRET='lshfosnfoshdfohvpng;w4vj0wu0ajc0iayvashvacaf' \
#   kevinedwards/formsite-api:0.0.1

# docker run -itd \
#   --network prod \
#   --name frontend \
#   -p 80:80 \
#   -v ./default.conf.http:/etc/nginx/conf.d/default.conf
#   kevinedwards/formsite-web:0.0.2
